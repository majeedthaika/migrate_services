{
  "name": "Stripe + Salesforce to Chargebee Migration",
  "version": "2.0",
  "description": "Complete migration mapping from Stripe billing and Salesforce CRM to Chargebee with comprehensive JOIN configurations",
  "sources": ["Stripe", "Salesforce"],
  "target": "Chargebee",
  "migration_order": [
    "ItemFamily",
    "Item",
    "ItemPrice",
    "Customer",
    "PaymentSource",
    "Subscription",
    "Invoice"
  ],
  "cross_schema_relationships": {
    "description": "Documents how entities relate across source providers for JOIN operations",
    "stripe_to_salesforce": [
      {
        "relationship": "Stripe.Customer to Salesforce.Contact",
        "join_fields": {
          "stripe": "email",
          "salesforce": "Email"
        },
        "type": "one_to_one",
        "confidence": "high",
        "notes": "Primary link between billing (Stripe) and CRM (Salesforce) data"
      },
      {
        "relationship": "Stripe.Customer to Salesforce.Account",
        "join_fields": {
          "stripe": "name",
          "salesforce": "Name"
        },
        "type": "one_to_one",
        "confidence": "medium",
        "notes": "Fallback: Match by company/account name if Contact not found"
      },
      {
        "relationship": "Stripe.Subscription to Salesforce.Opportunity",
        "join_path": "Stripe.Subscription -> Stripe.Customer (via customer) -> Salesforce.Contact (via Email) -> Salesforce.Opportunity (via AccountId)",
        "type": "many_to_many",
        "notes": "Links subscriptions to sales opportunities for revenue tracking"
      }
    ],
    "internal_stripe": [
      {
        "relationship": "Stripe.Price to Stripe.Product",
        "join_fields": {
          "price": "product",
          "product": "id"
        },
        "type": "many_to_one"
      },
      {
        "relationship": "Stripe.Subscription to Stripe.Customer",
        "join_fields": {
          "subscription": "customer",
          "customer": "id"
        },
        "type": "many_to_one"
      },
      {
        "relationship": "Stripe.Invoice to Stripe.Customer",
        "join_fields": {
          "invoice": "customer",
          "customer": "id"
        },
        "type": "many_to_one"
      },
      {
        "relationship": "Stripe.Invoice to Stripe.Subscription",
        "join_fields": {
          "invoice": "subscription",
          "subscription": "id"
        },
        "type": "many_to_one"
      },
      {
        "relationship": "Stripe.PaymentMethod to Stripe.Customer",
        "join_fields": {
          "payment_method": "customer",
          "customer": "id"
        },
        "type": "many_to_one"
      }
    ],
    "internal_salesforce": [
      {
        "relationship": "Salesforce.Contact to Salesforce.Account",
        "join_fields": {
          "contact": "AccountId",
          "account": "Id"
        },
        "type": "many_to_one"
      },
      {
        "relationship": "Salesforce.Opportunity to Salesforce.Account",
        "join_fields": {
          "opportunity": "AccountId",
          "account": "Id"
        },
        "type": "many_to_one"
      }
    ]
  },
  "mappings": {
    "Customer": {
      "source": "Stripe.Customer",
      "target": "Chargebee.Customer",
      "description": "Map Stripe customers enriched with Salesforce contact/account data to Chargebee customers",
      "cardinality": "many:1",
      "join_config": {
        "type": "left",
        "primary_source": {
          "service": "Stripe",
          "entity": "Customer"
        },
        "join_conditions": [
          {
            "left_source": { "service": "Stripe", "entity": "Customer" },
            "right_source": { "service": "Salesforce", "entity": "Contact" },
            "left_field": "email",
            "right_field": "Email",
            "operator": "equals",
            "description": "Match Stripe customer to Salesforce contact by email address"
          },
          {
            "left_source": { "service": "Salesforce", "entity": "Contact" },
            "right_source": { "service": "Salesforce", "entity": "Account" },
            "left_field": "AccountId",
            "right_field": "Id",
            "operator": "equals",
            "description": "Join Salesforce contact to their parent account"
          }
        ]
      },
      "additional_sources": [
        {
          "source": "Salesforce.Contact",
          "join_type": "left",
          "join_on": "email",
          "match_fields": ["Stripe.Customer.email", "Salesforce.Contact.Email"],
          "description": "Enrich with CRM contact data (name, title, department)"
        },
        {
          "source": "Salesforce.Account",
          "join_type": "left",
          "join_on": "contact_account",
          "match_fields": ["Salesforce.Contact.AccountId", "Salesforce.Account.Id"],
          "description": "Enrich with company data (industry, revenue, employees)"
        }
      ],
      "field_mappings": [
        {
          "source_field": "id",
          "target_field": "id",
          "transform": "prefix",
          "transform_config": { "prefix": "stripe_" },
          "notes": "Prefix Stripe ID to avoid conflicts and maintain traceability"
        },
        {
          "source": "Salesforce.Contact",
          "source_field": "FirstName",
          "target_field": "first_name",
          "transform": "direct",
          "priority": 1,
          "notes": "Primary: Use Salesforce first name for better CRM data quality"
        },
        {
          "source": "Salesforce.Contact",
          "source_field": "LastName",
          "target_field": "last_name",
          "transform": "direct",
          "priority": 1,
          "notes": "Primary: Use Salesforce last name for better CRM data quality"
        },
        {
          "source_field": "name",
          "target_field": "first_name",
          "transform": "split_name_first",
          "transform_config": { "delimiter": " ", "index": 0 },
          "priority": 2,
          "fallback_for": "Salesforce.Contact.FirstName",
          "notes": "Fallback: Extract first name from Stripe full name if Salesforce unavailable"
        },
        {
          "source_field": "name",
          "target_field": "last_name",
          "transform": "split_name_last",
          "transform_config": { "delimiter": " ", "index": -1 },
          "priority": 2,
          "fallback_for": "Salesforce.Contact.LastName",
          "notes": "Fallback: Extract last name from Stripe full name if Salesforce unavailable"
        },
        {
          "source_field": "email",
          "target_field": "email",
          "transform": "direct",
          "notes": "Direct email mapping - this is the JOIN key with Salesforce"
        },
        {
          "source": "Salesforce.Contact",
          "source_field": "Phone",
          "target_field": "phone",
          "transform": "direct",
          "priority": 1,
          "notes": "Primary: Use Salesforce phone (often more up-to-date)"
        },
        {
          "source_field": "phone",
          "target_field": "phone",
          "transform": "direct",
          "priority": 2,
          "fallback_for": "Salesforce.Contact.Phone",
          "notes": "Fallback: Use Stripe phone if Salesforce not available"
        },
        {
          "source": "Salesforce.Account",
          "source_field": "Name",
          "target_field": "company",
          "transform": "direct",
          "notes": "Company name from Salesforce Account (joined via Contact.AccountId)"
        },
        {
          "source": "Salesforce.Account",
          "source_field": "Industry",
          "target_field": "meta_data.industry",
          "transform": "direct",
          "notes": "Store industry in metadata for segmentation"
        },
        {
          "source": "Salesforce.Account",
          "source_field": "AnnualRevenue",
          "target_field": "meta_data.annual_revenue",
          "transform": "direct",
          "notes": "Store annual revenue in metadata for segmentation"
        },
        {
          "source": "Salesforce.Account",
          "source_field": "NumberOfEmployees",
          "target_field": "meta_data.employee_count",
          "transform": "direct",
          "notes": "Store employee count in metadata"
        },
        {
          "source": "Salesforce.Account",
          "source_field": "Website",
          "target_field": "meta_data.website",
          "transform": "direct",
          "notes": "Store company website from Salesforce"
        },
        {
          "source": "Salesforce.Account",
          "source_field": "Type",
          "target_field": "meta_data.account_type",
          "transform": "direct",
          "notes": "Store Salesforce account type (Prospect, Customer, Partner, etc.)"
        },
        {
          "source_field": "address.line1",
          "target_field": "billing_address.line1",
          "transform": "direct",
          "priority": 1,
          "notes": "Stripe billing address line 1"
        },
        {
          "source": "Salesforce.Account",
          "source_field": "BillingStreet",
          "target_field": "billing_address.line1",
          "transform": "direct",
          "priority": 2,
          "fallback_for": "Stripe.Customer.address.line1",
          "notes": "Fallback: Use Salesforce billing street if Stripe address empty"
        },
        {
          "source_field": "address.line2",
          "target_field": "billing_address.line2",
          "transform": "direct"
        },
        {
          "source_field": "address.city",
          "target_field": "billing_address.city",
          "transform": "direct",
          "priority": 1
        },
        {
          "source": "Salesforce.Account",
          "source_field": "BillingCity",
          "target_field": "billing_address.city",
          "transform": "direct",
          "priority": 2,
          "fallback_for": "Stripe.Customer.address.city"
        },
        {
          "source_field": "address.state",
          "target_field": "billing_address.state",
          "transform": "direct",
          "priority": 1
        },
        {
          "source": "Salesforce.Account",
          "source_field": "BillingState",
          "target_field": "billing_address.state",
          "transform": "direct",
          "priority": 2,
          "fallback_for": "Stripe.Customer.address.state"
        },
        {
          "source_field": "address.postal_code",
          "target_field": "billing_address.zip",
          "transform": "direct",
          "priority": 1
        },
        {
          "source": "Salesforce.Account",
          "source_field": "BillingPostalCode",
          "target_field": "billing_address.zip",
          "transform": "direct",
          "priority": 2,
          "fallback_for": "Stripe.Customer.address.postal_code"
        },
        {
          "source_field": "address.country",
          "target_field": "billing_address.country",
          "transform": "iso_country_code",
          "notes": "Convert to ISO 3166-1 alpha-2 code"
        },
        {
          "source_field": "currency",
          "target_field": "preferred_currency_code",
          "transform": "uppercase",
          "notes": "Ensure uppercase currency code"
        },
        {
          "source_field": "balance",
          "target_field": "promotional_credits",
          "transform": "direct",
          "notes": "Map Stripe balance to promotional credits (if positive)"
        },
        {
          "source_field": "tax_exempt",
          "target_field": "taxability",
          "transform": "value_map",
          "transform_config": {
            "mapping": {
              "none": "taxable",
              "exempt": "exempt",
              "reverse": "exempt"
            },
            "default": "taxable"
          }
        },
        {
          "source_field": "created",
          "target_field": "created_at",
          "transform": "direct",
          "notes": "Unix timestamp - direct mapping"
        },
        {
          "source_field": "metadata",
          "target_field": "meta_data",
          "transform": "merge_objects",
          "notes": "Merge Stripe metadata with enriched Salesforce data"
        },
        {
          "source_field": "id",
          "target_field": "meta_data.stripe_customer_id",
          "transform": "direct",
          "notes": "Store original Stripe ID for reference"
        },
        {
          "source": "Salesforce.Contact",
          "source_field": "Id",
          "target_field": "meta_data.salesforce_contact_id",
          "transform": "direct",
          "notes": "Store Salesforce Contact ID for reference"
        },
        {
          "source": "Salesforce.Account",
          "source_field": "Id",
          "target_field": "meta_data.salesforce_account_id",
          "transform": "direct",
          "notes": "Store Salesforce Account ID for reference"
        },
        {
          "source": "Salesforce.Contact",
          "source_field": "Title",
          "target_field": "meta_data.job_title",
          "transform": "direct",
          "notes": "Store job title in metadata"
        },
        {
          "source": "Salesforce.Contact",
          "source_field": "Department",
          "target_field": "meta_data.department",
          "transform": "direct",
          "notes": "Store department in metadata"
        },
        {
          "source": "Salesforce.Contact",
          "source_field": "LeadSource",
          "target_field": "meta_data.lead_source",
          "transform": "direct",
          "notes": "Store lead source for attribution"
        },
        {
          "source": "Salesforce.Contact",
          "source_field": "HasOptedOutOfEmail",
          "target_field": "meta_data.email_opt_out",
          "transform": "direct",
          "notes": "Preserve email opt-out preference from Salesforce"
        },
        {
          "source": "Salesforce.Contact",
          "source_field": "DoNotCall",
          "target_field": "meta_data.do_not_call",
          "transform": "direct",
          "notes": "Preserve do-not-call preference from Salesforce"
        }
      ]
    },
    "Item": {
      "source": "Stripe.Product",
      "target": "Chargebee.Item",
      "description": "Map Stripe products to Chargebee items (Product Catalog 2.0)",
      "cardinality": "1:1",
      "field_mappings": [
        {
          "source_field": "id",
          "target_field": "id",
          "transform": "prefix",
          "transform_config": { "prefix": "stripe_" },
          "notes": "Prefix to maintain traceability"
        },
        {
          "source_field": "name",
          "target_field": "name",
          "transform": "truncate",
          "transform_config": { "max_length": 50 },
          "notes": "Chargebee name has 50 char limit"
        },
        {
          "source_field": "name",
          "target_field": "external_name",
          "transform": "truncate",
          "transform_config": { "max_length": 100 },
          "notes": "Full name as external name"
        },
        {
          "source_field": "description",
          "target_field": "description",
          "transform": "truncate",
          "transform_config": { "max_length": 500 }
        },
        {
          "source_field": "type",
          "target_field": "type",
          "transform": "value_map",
          "transform_config": {
            "mapping": {
              "service": "plan",
              "good": "charge"
            },
            "default": "plan"
          },
          "notes": "Map Stripe product type to Chargebee item type"
        },
        {
          "source_field": "active",
          "target_field": "status",
          "transform": "value_map",
          "transform_config": {
            "mapping": {
              "true": "active",
              "false": "archived"
            }
          }
        },
        {
          "source_field": null,
          "target_field": "item_family_id",
          "transform": "static",
          "transform_config": { "value": "default-family" },
          "notes": "Assign to default item family - update based on product categorization"
        },
        {
          "source_field": "metadata",
          "target_field": "meta_data",
          "transform": "direct"
        },
        {
          "source_field": "id",
          "target_field": "meta_data.stripe_product_id",
          "transform": "direct",
          "notes": "Store original Stripe product ID"
        },
        {
          "source_field": "images",
          "target_field": "meta_data.images",
          "transform": "direct",
          "notes": "Store image URLs in metadata"
        },
        {
          "source_field": "tax_code",
          "target_field": "meta_data.tax_code",
          "transform": "direct",
          "notes": "Store Stripe tax code for reference"
        },
        {
          "source_field": "default_price",
          "target_field": "meta_data.stripe_default_price_id",
          "transform": "direct",
          "notes": "Store default price ID for reference"
        }
      ]
    },
    "ItemPrice": {
      "source": "Stripe.Price",
      "target": "Chargebee.ItemPrice",
      "description": "Map Stripe prices to Chargebee item prices with product enrichment",
      "cardinality": "many:1",
      "join_config": {
        "type": "inner",
        "primary_source": {
          "service": "Stripe",
          "entity": "Price"
        },
        "join_conditions": [
          {
            "left_source": { "service": "Stripe", "entity": "Price" },
            "right_source": { "service": "Stripe", "entity": "Product" },
            "left_field": "product",
            "right_field": "id",
            "operator": "equals",
            "description": "Join Price to its parent Product to get product name and metadata"
          }
        ]
      },
      "additional_sources": [
        {
          "source": "Stripe.Product",
          "join_type": "inner",
          "join_on": "product_id",
          "match_fields": ["Stripe.Price.product", "Stripe.Product.id"],
          "description": "Get product details for price naming and categorization"
        }
      ],
      "field_mappings": [
        {
          "source_field": "id",
          "target_field": "id",
          "transform": "prefix",
          "transform_config": { "prefix": "stripe_" }
        },
        {
          "source_field": "nickname",
          "target_field": "name",
          "transform": "coalesce",
          "transform_config": {
            "fallback_field": "Stripe.Product.name",
            "max_length": 50
          },
          "notes": "Use nickname if available, otherwise product name"
        },
        {
          "source": "Stripe.Product",
          "source_field": "name",
          "target_field": "external_name",
          "transform": "truncate",
          "transform_config": { "max_length": 100 },
          "notes": "Use product name as external name"
        },
        {
          "source": "Stripe.Product",
          "source_field": "description",
          "target_field": "description",
          "transform": "truncate",
          "transform_config": { "max_length": 500 },
          "notes": "Use product description"
        },
        {
          "source_field": "product",
          "target_field": "item_id",
          "transform": "prefix",
          "transform_config": { "prefix": "stripe_" },
          "notes": "Reference the migrated item ID"
        },
        {
          "source_field": "type",
          "target_field": "item_type",
          "transform": "value_map",
          "transform_config": {
            "mapping": {
              "recurring": "plan",
              "one_time": "charge"
            }
          }
        },
        {
          "source_field": "unit_amount",
          "target_field": "price",
          "transform": "direct",
          "notes": "Both use cents - direct mapping"
        },
        {
          "source_field": "currency",
          "target_field": "currency_code",
          "transform": "uppercase"
        },
        {
          "source_field": "billing_scheme",
          "target_field": "pricing_model",
          "transform": "value_map",
          "transform_config": {
            "mapping": {
              "per_unit": "per_unit",
              "tiered": "tiered"
            }
          }
        },
        {
          "source_field": "recurring.interval_count",
          "target_field": "period",
          "transform": "direct",
          "notes": "Number of intervals"
        },
        {
          "source_field": "recurring.interval",
          "target_field": "period_unit",
          "transform": "direct",
          "notes": "day, week, month, year - same values"
        },
        {
          "source_field": "recurring.trial_period_days",
          "target_field": "trial_period",
          "transform": "direct"
        },
        {
          "source_field": null,
          "target_field": "trial_period_unit",
          "transform": "conditional",
          "transform_config": {
            "condition": "field_exists",
            "field": "recurring.trial_period_days",
            "then": "day",
            "else": null
          },
          "notes": "Stripe trial is always in days"
        },
        {
          "source_field": "tiers",
          "target_field": "tiers",
          "transform": "map_array",
          "transform_config": {
            "field_mappings": [
              { "source": "up_to", "target": "ending_unit" },
              { "source": "unit_amount", "target": "price" },
              { "source": "flat_amount", "target": "price" }
            ]
          },
          "notes": "Map tiered pricing structure"
        },
        {
          "source_field": "tiers_mode",
          "target_field": "pricing_model",
          "transform": "value_map",
          "transform_config": {
            "mapping": {
              "graduated": "tiered",
              "volume": "volume"
            }
          },
          "notes": "Override pricing_model if tiered pricing is used"
        },
        {
          "source_field": "active",
          "target_field": "status",
          "transform": "value_map",
          "transform_config": {
            "mapping": {
              "true": "active",
              "false": "archived"
            }
          }
        },
        {
          "source_field": "created",
          "target_field": "created_at",
          "transform": "direct"
        },
        {
          "source_field": "metadata",
          "target_field": "meta_data",
          "transform": "merge_objects"
        },
        {
          "source_field": "id",
          "target_field": "meta_data.stripe_price_id",
          "transform": "direct"
        },
        {
          "source": "Stripe.Product",
          "source_field": "id",
          "target_field": "meta_data.stripe_product_id",
          "transform": "direct"
        },
        {
          "source": "Stripe.Product",
          "source_field": "tax_code",
          "target_field": "meta_data.tax_code",
          "transform": "direct",
          "notes": "Inherit tax code from product"
        }
      ]
    },
    "Subscription": {
      "source": "Stripe.Subscription",
      "target": "Chargebee.Subscription",
      "description": "Map Stripe subscriptions to Chargebee subscriptions with customer and CRM enrichment",
      "cardinality": "many:1",
      "join_config": {
        "type": "left",
        "primary_source": {
          "service": "Stripe",
          "entity": "Subscription"
        },
        "join_conditions": [
          {
            "left_source": { "service": "Stripe", "entity": "Subscription" },
            "right_source": { "service": "Stripe", "entity": "Customer" },
            "left_field": "customer",
            "right_field": "id",
            "operator": "equals",
            "description": "Join subscription to customer for enrichment"
          },
          {
            "left_source": { "service": "Stripe", "entity": "Customer" },
            "right_source": { "service": "Salesforce", "entity": "Contact" },
            "left_field": "email",
            "right_field": "Email",
            "operator": "equals",
            "description": "Link to Salesforce contact via customer email"
          },
          {
            "left_source": { "service": "Salesforce", "entity": "Contact" },
            "right_source": { "service": "Salesforce", "entity": "Opportunity" },
            "left_field": "AccountId",
            "right_field": "AccountId",
            "operator": "equals",
            "description": "Link to Salesforce opportunity via account"
          }
        ]
      },
      "additional_sources": [
        {
          "source": "Stripe.Customer",
          "join_type": "inner",
          "join_on": "customer_id",
          "match_fields": ["Stripe.Subscription.customer", "Stripe.Customer.id"],
          "description": "Get customer email for Salesforce linkage"
        },
        {
          "source": "Salesforce.Contact",
          "join_type": "left",
          "join_on": "customer_email",
          "match_fields": ["Stripe.Customer.email", "Salesforce.Contact.Email"],
          "description": "Link to CRM contact"
        },
        {
          "source": "Salesforce.Opportunity",
          "join_type": "left",
          "join_on": "account_opportunity",
          "match_fields": ["Salesforce.Contact.AccountId", "Salesforce.Opportunity.AccountId"],
          "filter": {
            "field": "IsWon",
            "operator": "equals",
            "value": true
          },
          "description": "Get closed-won opportunity data for sales attribution"
        }
      ],
      "field_mappings": [
        {
          "source_field": "id",
          "target_field": "id",
          "transform": "prefix",
          "transform_config": { "prefix": "stripe_" }
        },
        {
          "source_field": "customer",
          "target_field": "customer_id",
          "transform": "prefix",
          "transform_config": { "prefix": "stripe_" },
          "notes": "Reference migrated customer ID"
        },
        {
          "source_field": "status",
          "target_field": "status",
          "transform": "value_map",
          "transform_config": {
            "mapping": {
              "active": "active",
              "trialing": "in_trial",
              "past_due": "active",
              "canceled": "cancelled",
              "unpaid": "non_renewing",
              "incomplete": "future",
              "incomplete_expired": "cancelled",
              "paused": "paused"
            }
          },
          "notes": "Map Stripe status to Chargebee status"
        },
        {
          "source_field": "current_period_start",
          "target_field": "current_term_start",
          "transform": "direct"
        },
        {
          "source_field": "current_period_end",
          "target_field": "current_term_end",
          "transform": "direct"
        },
        {
          "source_field": "current_period_end",
          "target_field": "next_billing_at",
          "transform": "direct",
          "notes": "Next billing is at period end"
        },
        {
          "source_field": "created",
          "target_field": "created_at",
          "transform": "direct"
        },
        {
          "source_field": "start_date",
          "target_field": "started_at",
          "transform": "direct"
        },
        {
          "source_field": "canceled_at",
          "target_field": "cancelled_at",
          "transform": "direct"
        },
        {
          "source_field": "trial_start",
          "target_field": "trial_start",
          "transform": "direct"
        },
        {
          "source_field": "trial_end",
          "target_field": "trial_end",
          "transform": "direct"
        },
        {
          "source_field": "currency",
          "target_field": "currency_code",
          "transform": "uppercase"
        },
        {
          "source_field": "items.data",
          "target_field": "subscription_items",
          "transform": "map_array",
          "transform_config": {
            "field_mappings": [
              {
                "source": "price.id",
                "target": "item_price_id",
                "transform": "prefix",
                "transform_config": { "prefix": "stripe_" }
              },
              { "source": "quantity", "target": "quantity" },
              { "source": "price.unit_amount", "target": "unit_price" },
              {
                "source": "price.type",
                "target": "item_type",
                "transform": "value_map",
                "transform_config": {
                  "mapping": {
                    "recurring": "plan",
                    "one_time": "charge"
                  }
                }
              }
            ]
          },
          "notes": "Map subscription items with price references"
        },
        {
          "source_field": "collection_method",
          "target_field": "auto_collection",
          "transform": "value_map",
          "transform_config": {
            "mapping": {
              "charge_automatically": "on",
              "send_invoice": "off"
            }
          }
        },
        {
          "source_field": "metadata",
          "target_field": "meta_data",
          "transform": "merge_objects"
        },
        {
          "source_field": "id",
          "target_field": "meta_data.stripe_subscription_id",
          "transform": "direct"
        },
        {
          "source_field": "default_payment_method",
          "target_field": "meta_data.stripe_payment_method_id",
          "transform": "direct",
          "notes": "Store for payment source linking"
        },
        {
          "source_field": "billing_cycle_anchor",
          "target_field": "meta_data.billing_cycle_anchor",
          "transform": "direct"
        },
        {
          "source": "Stripe.Customer",
          "source_field": "email",
          "target_field": "meta_data.customer_email",
          "transform": "direct",
          "notes": "Store customer email from joined Customer entity"
        },
        {
          "source": "Salesforce.Opportunity",
          "source_field": "Id",
          "target_field": "meta_data.salesforce_opportunity_id",
          "transform": "direct",
          "notes": "Store related Salesforce opportunity ID"
        },
        {
          "source": "Salesforce.Opportunity",
          "source_field": "Name",
          "target_field": "meta_data.opportunity_name",
          "transform": "direct",
          "notes": "Store opportunity name for reference"
        },
        {
          "source": "Salesforce.Opportunity",
          "source_field": "Amount",
          "target_field": "meta_data.opportunity_amount",
          "transform": "direct",
          "notes": "Store original opportunity amount"
        },
        {
          "source": "Salesforce.Opportunity",
          "source_field": "CloseDate",
          "target_field": "meta_data.opportunity_close_date",
          "transform": "direct",
          "notes": "Store opportunity close date"
        },
        {
          "source": "Salesforce.Opportunity",
          "source_field": "LeadSource",
          "target_field": "meta_data.lead_source",
          "transform": "direct",
          "notes": "Store lead source for attribution"
        },
        {
          "source": "Salesforce.Contact",
          "source_field": "OwnerId",
          "target_field": "meta_data.salesforce_owner_id",
          "transform": "direct",
          "notes": "Store sales rep owner ID"
        },
        {
          "source_field": "cancel_at_period_end",
          "target_field": "status",
          "transform": "conditional",
          "transform_config": {
            "condition": "equals",
            "value": true,
            "then": "non_renewing",
            "else": null
          },
          "notes": "Override status if subscription will cancel at period end"
        }
      ]
    },
    "Invoice": {
      "source": "Stripe.Invoice",
      "target": "Chargebee.Invoice",
      "description": "Map Stripe invoices to Chargebee invoices with customer and subscription context",
      "cardinality": "many:1",
      "join_config": {
        "type": "left",
        "primary_source": {
          "service": "Stripe",
          "entity": "Invoice"
        },
        "join_conditions": [
          {
            "left_source": { "service": "Stripe", "entity": "Invoice" },
            "right_source": { "service": "Stripe", "entity": "Customer" },
            "left_field": "customer",
            "right_field": "id",
            "operator": "equals",
            "description": "Join invoice to customer"
          },
          {
            "left_source": { "service": "Stripe", "entity": "Invoice" },
            "right_source": { "service": "Stripe", "entity": "Subscription" },
            "left_field": "subscription",
            "right_field": "id",
            "operator": "equals",
            "description": "Join invoice to subscription"
          }
        ]
      },
      "additional_sources": [
        {
          "source": "Stripe.Customer",
          "join_type": "left",
          "join_on": "customer_id",
          "match_fields": ["Stripe.Invoice.customer", "Stripe.Customer.id"],
          "description": "Get customer details for invoice context"
        },
        {
          "source": "Stripe.Subscription",
          "join_type": "left",
          "join_on": "subscription_id",
          "match_fields": ["Stripe.Invoice.subscription", "Stripe.Subscription.id"],
          "description": "Get subscription details for invoice context"
        }
      ],
      "field_mappings": [
        {
          "source_field": "id",
          "target_field": "id",
          "transform": "prefix",
          "transform_config": { "prefix": "stripe_" }
        },
        {
          "source_field": "customer",
          "target_field": "customer_id",
          "transform": "prefix",
          "transform_config": { "prefix": "stripe_" }
        },
        {
          "source_field": "subscription",
          "target_field": "subscription_id",
          "transform": "prefix",
          "transform_config": { "prefix": "stripe_" }
        },
        {
          "source_field": "status",
          "target_field": "status",
          "transform": "value_map",
          "transform_config": {
            "mapping": {
              "draft": "pending",
              "open": "payment_due",
              "paid": "paid",
              "uncollectible": "not_paid",
              "void": "voided"
            }
          }
        },
        {
          "source_field": "currency",
          "target_field": "currency_code",
          "transform": "uppercase"
        },
        {
          "source_field": "total",
          "target_field": "total",
          "transform": "direct",
          "notes": "Both in cents"
        },
        {
          "source_field": "subtotal",
          "target_field": "sub_total",
          "transform": "direct"
        },
        {
          "source_field": "amount_paid",
          "target_field": "amount_paid",
          "transform": "direct"
        },
        {
          "source_field": "amount_due",
          "target_field": "amount_due",
          "transform": "direct"
        },
        {
          "source_field": "created",
          "target_field": "date",
          "transform": "direct"
        },
        {
          "source_field": "created",
          "target_field": "created_at",
          "transform": "direct"
        },
        {
          "source_field": "due_date",
          "target_field": "due_date",
          "transform": "direct"
        },
        {
          "source_field": null,
          "target_field": "price_type",
          "transform": "static",
          "transform_config": { "value": "tax_exclusive" },
          "notes": "Stripe typically uses tax-exclusive pricing"
        },
        {
          "source_field": "lines.data",
          "target_field": "line_items",
          "transform": "map_array",
          "transform_config": {
            "field_mappings": [
              { "source": "id", "target": "id" },
              { "source": "period.start", "target": "date_from" },
              { "source": "period.end", "target": "date_to" },
              { "source": "amount", "target": "amount" },
              { "source": "quantity", "target": "quantity" },
              { "source": "unit_amount", "target": "unit_amount" },
              { "source": "description", "target": "description" },
              {
                "source": "price.id",
                "target": "entity_id",
                "transform": "prefix",
                "transform_config": { "prefix": "stripe_" }
              },
              {
                "source": "type",
                "target": "entity_type",
                "transform": "value_map",
                "transform_config": {
                  "mapping": {
                    "subscription": "item_price",
                    "invoiceitem": "item_price"
                  }
                }
              }
            ]
          }
        },
        {
          "source_field": "id",
          "target_field": "meta_data.stripe_invoice_id",
          "transform": "direct"
        },
        {
          "source_field": "number",
          "target_field": "meta_data.stripe_invoice_number",
          "transform": "direct"
        },
        {
          "source_field": "invoice_pdf",
          "target_field": "meta_data.stripe_invoice_pdf",
          "transform": "direct"
        },
        {
          "source": "Stripe.Customer",
          "source_field": "email",
          "target_field": "meta_data.customer_email",
          "transform": "direct",
          "notes": "Store customer email from joined entity"
        },
        {
          "source": "Stripe.Customer",
          "source_field": "name",
          "target_field": "meta_data.customer_name",
          "transform": "direct",
          "notes": "Store customer name from joined entity"
        },
        {
          "source": "Stripe.Subscription",
          "source_field": "status",
          "target_field": "meta_data.subscription_status",
          "transform": "direct",
          "notes": "Store subscription status at time of invoice"
        }
      ]
    },
    "PaymentSource": {
      "source": "Stripe.PaymentMethod",
      "target": "Chargebee.PaymentSource",
      "description": "Map Stripe payment methods to Chargebee payment sources with customer context",
      "cardinality": "many:1",
      "join_config": {
        "type": "left",
        "primary_source": {
          "service": "Stripe",
          "entity": "PaymentMethod"
        },
        "join_conditions": [
          {
            "left_source": { "service": "Stripe", "entity": "PaymentMethod" },
            "right_source": { "service": "Stripe", "entity": "Customer" },
            "left_field": "customer",
            "right_field": "id",
            "operator": "equals",
            "description": "Join payment method to customer for context"
          }
        ]
      },
      "additional_sources": [
        {
          "source": "Stripe.Customer",
          "join_type": "left",
          "join_on": "customer_id",
          "match_fields": ["Stripe.PaymentMethod.customer", "Stripe.Customer.id"],
          "description": "Get customer details to determine primary payment method"
        }
      ],
      "field_mappings": [
        {
          "source_field": "id",
          "target_field": "id",
          "transform": "prefix",
          "transform_config": { "prefix": "stripe_" }
        },
        {
          "source_field": "customer",
          "target_field": "customer_id",
          "transform": "prefix",
          "transform_config": { "prefix": "stripe_" }
        },
        {
          "source_field": "type",
          "target_field": "type",
          "transform": "value_map",
          "transform_config": {
            "mapping": {
              "card": "card",
              "sepa_debit": "direct_debit",
              "us_bank_account": "direct_debit",
              "bank_account": "direct_debit"
            },
            "default": "card"
          }
        },
        {
          "source_field": null,
          "target_field": "status",
          "transform": "static",
          "transform_config": { "value": "valid" },
          "notes": "Assume valid - Stripe doesn't expose invalid methods"
        },
        {
          "source_field": null,
          "target_field": "gateway",
          "transform": "static",
          "transform_config": { "value": "stripe" },
          "notes": "Set gateway to stripe for reference"
        },
        {
          "source_field": "id",
          "target_field": "reference_id",
          "transform": "direct",
          "notes": "Store Stripe payment method ID as reference"
        },
        {
          "source_field": "card.brand",
          "target_field": "card.brand",
          "transform": "lowercase",
          "notes": "Chargebee uses lowercase card brands"
        },
        {
          "source_field": "card.last4",
          "target_field": "card.last4",
          "transform": "direct"
        },
        {
          "source_field": "card.exp_month",
          "target_field": "card.expiry_month",
          "transform": "direct"
        },
        {
          "source_field": "card.exp_year",
          "target_field": "card.expiry_year",
          "transform": "direct"
        },
        {
          "source_field": "card.funding",
          "target_field": "card.funding_type",
          "transform": "value_map",
          "transform_config": {
            "mapping": {
              "credit": "credit",
              "debit": "debit",
              "prepaid": "prepaid",
              "unknown": "not_known"
            }
          }
        },
        {
          "source_field": "billing_details.name",
          "target_field": "card.first_name",
          "transform": "split_name_first",
          "transform_config": { "delimiter": " " }
        },
        {
          "source_field": "billing_details.name",
          "target_field": "card.last_name",
          "transform": "split_name_last",
          "transform_config": { "delimiter": " " }
        },
        {
          "source_field": "created",
          "target_field": "created_at",
          "transform": "direct"
        },
        {
          "source": "Stripe.Customer",
          "source_field": "default_source",
          "target_field": "meta_data.is_default",
          "transform": "computed",
          "transform_config": {
            "expression": "Stripe.PaymentMethod.id == Stripe.Customer.default_source"
          },
          "notes": "Determine if this is the customer's default payment method"
        },
        {
          "source": "Stripe.Customer",
          "source_field": "email",
          "target_field": "meta_data.customer_email",
          "transform": "direct",
          "notes": "Store customer email from joined entity"
        }
      ]
    },
    "ItemFamily": {
      "source": null,
      "target": "Chargebee.ItemFamily",
      "description": "Create default item family for migrated products",
      "notes": "ItemFamily is required in Chargebee Product Catalog 2.0. Create a default family for all migrated items.",
      "static_records": [
        {
          "id": "default-family",
          "name": "Migrated Products",
          "description": "Products migrated from Stripe",
          "status": "active"
        }
      ]
    }
  },
  "transforms": {
    "prefix": {
      "description": "Add a prefix to the value",
      "parameters": ["prefix"]
    },
    "direct": {
      "description": "Direct value mapping without transformation"
    },
    "value_map": {
      "description": "Map source values to target values using a lookup table",
      "parameters": ["mapping", "default"]
    },
    "truncate": {
      "description": "Truncate string to maximum length",
      "parameters": ["max_length"]
    },
    "uppercase": {
      "description": "Convert string to uppercase"
    },
    "lowercase": {
      "description": "Convert string to lowercase"
    },
    "split_name_first": {
      "description": "Extract first name from full name",
      "parameters": ["delimiter"]
    },
    "split_name_last": {
      "description": "Extract last name from full name",
      "parameters": ["delimiter"]
    },
    "static": {
      "description": "Use a static value",
      "parameters": ["value"]
    },
    "coalesce": {
      "description": "Use first non-null value from multiple fields",
      "parameters": ["fallback_field"]
    },
    "merge_objects": {
      "description": "Merge multiple objects into one"
    },
    "map_array": {
      "description": "Transform array items using field mappings",
      "parameters": ["field_mappings"]
    },
    "conditional": {
      "description": "Conditional transformation based on value",
      "parameters": ["condition", "value", "then", "else"]
    },
    "iso_country_code": {
      "description": "Convert country name to ISO 3166-1 alpha-2 code"
    },
    "computed": {
      "description": "Compute value based on expression",
      "parameters": ["expression"]
    }
  },
  "validation_rules": [
    {
      "entity": "Customer",
      "field": "email",
      "rule": "required_if_no_company",
      "message": "Customer must have either email or company name"
    },
    {
      "entity": "Customer",
      "field": "meta_data.salesforce_contact_id",
      "rule": "warn_if_null",
      "message": "Customer not matched to Salesforce contact - CRM enrichment unavailable"
    },
    {
      "entity": "Subscription",
      "field": "customer_id",
      "rule": "exists_in_target",
      "target_entity": "Customer",
      "message": "Customer must be migrated before subscription"
    },
    {
      "entity": "Subscription",
      "field": "subscription_items",
      "rule": "not_empty",
      "message": "Subscription must have at least one item"
    },
    {
      "entity": "ItemPrice",
      "field": "item_id",
      "rule": "exists_in_target",
      "target_entity": "Item",
      "message": "Item must be migrated before item price"
    },
    {
      "entity": "Invoice",
      "field": "customer_id",
      "rule": "exists_in_target",
      "target_entity": "Customer",
      "message": "Customer must be migrated before invoice"
    },
    {
      "entity": "PaymentSource",
      "field": "customer_id",
      "rule": "exists_in_target",
      "target_entity": "Customer",
      "message": "Customer must be migrated before payment source"
    }
  ],
  "join_strategies": {
    "description": "Strategies for handling JOIN operations during migration",
    "strategies": [
      {
        "name": "email_match",
        "description": "Match records by email address",
        "fields": ["email", "Email"],
        "normalization": "lowercase_trim",
        "fallback": "skip"
      },
      {
        "name": "id_reference",
        "description": "Match records by foreign key ID reference",
        "fields": ["*_id", "*Id"],
        "normalization": "none",
        "fallback": "error"
      },
      {
        "name": "name_fuzzy",
        "description": "Fuzzy match by company/account name",
        "fields": ["name", "Name", "company", "Company"],
        "normalization": "lowercase_trim_remove_punctuation",
        "similarity_threshold": 0.85,
        "fallback": "skip"
      }
    ]
  },
  "post_migration_notes": [
    "Verify all customer balances are correctly migrated",
    "Test subscription billing cycles match original dates",
    "Validate payment methods are tokenized correctly in Chargebee gateway",
    "Review any customers with multiple Salesforce contacts and consolidate if needed",
    "Update webhook endpoints to point to Chargebee",
    "Test invoice generation and email delivery",
    "Verify tax calculations are consistent",
    "Validate Salesforce-enriched metadata is properly stored",
    "Check that cross-provider JOINs matched expected number of records",
    "Review subscription-to-opportunity linkages for sales attribution accuracy"
  ]
}
